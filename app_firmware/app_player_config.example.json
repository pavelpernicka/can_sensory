{
  "_description": "Example config for app_player.py. Keys starting with '_' are documentation-only and ignored by the player.",
  "_top_level_descriptions": {
    "defaults": "Base values applied to every device unless overridden in devices.<id>.",
    "devices": "Per-device overrides keyed by CAN device ID string (for example '1', '2', '3').",
    "devices.<id>": "Overrides for one device. Any field from defaults can be overridden here.",
    "devices.<id>.instrument": "Instrument selection for this device."
  },
  "_field_descriptions": {
    "event_source": "Event source mode: 'hardware' (use events from firmware) or 'software' (derive events from MAG stream in player).",
    "note_map": "MIDI notes mapped to sectors 1..N. Sector index wraps if there are more sectors than notes.",
    "crossfade_ms": "Crossfade time in milliseconds when changing notes/sectors.",
    "release_ms": "Release fade time in milliseconds for note-off in normal mode.",
    "gain": "Per-device gain multiplier applied after note level (recommended 0.0..2.0).",
    "intensity_full_scale": "Input intensity value treated as 100% for dynamic mapping.",
    "min_level": "Minimum output level (0..1) when intensity is above zero in dynamic mode.",
    "max_level": "Maximum output level (0..1) in dynamic mode.",
    "dynamics_gamma": "Curve for intensity->level mapping. >1 gives softer low-end, <1 gives stronger low-end.",
    "velocity_min": "Minimum MIDI velocity used by dynamic mapping (1..127).",
    "velocity_max": "Maximum MIDI velocity used by dynamic mapping (1..127).",
    "retrigger_level_threshold": "If current level is below this value, same-note event forces retrigger.",
    "keyboard_mode": "If true, disables continuous dynamics: sector enter = fixed note-on, zero zone = note-off.",
    "keyboard_level": "Fixed note level (0..1) used in keyboard_mode.",
    "keyboard_velocity": "Fixed MIDI velocity (1..127) used in keyboard_mode.",
    "keyboard_release_ms": "Release fade time in milliseconds used in keyboard_mode.",
    "hold_note_in_sector": "If true, sustain while staying in the same sector and only crossfade when sector changes.",
    "hold_zero_grace_ms": "Grace time to keep sustaining during brief zero-zone drops before stopping note (used with EVENT_STATE).",
    "intensity_changes_enabled": "If false, ignore intensity/elevation updates after note-on (fixed sustain level until sector/off change).",
    "hold_sustain_floor": "Minimum sustained level (0..1) while hold_note_in_sector is active and sector is non-zero.",
    "event_retrigger_debounce_ms": "Minimum time between automatic retriggers/crossfades from EVENT_STATE transitions.",
    "level_fade_ms": "Smoothing time in milliseconds for level-only changes (INTENSITY_CHANGE / same-sector updates).",
    "instrument.soundfont": "Path to .sf2 file (absolute or relative to app_firmware directory).",
    "instrument.bank": "MIDI bank number for selected soundfont.",
    "instrument.preset": "MIDI preset/program number for selected soundfont."
  },
  "defaults": {
    "event_source": "hardware",
    "note_map": [60, 61, 63, 65, 66, 68],
    "crossfade_ms": 90,
    "release_ms": 450,
    "gain": 1.0,
    "intensity_full_scale": 100,
    "min_level": 0.12,
    "max_level": 1.0,
    "dynamics_gamma": 1.7,
    "velocity_min": 24,
    "velocity_max": 127,
    "retrigger_level_threshold": 0.03,
    "keyboard_mode": false,
    "keyboard_level": 1.0,
    "keyboard_velocity": 110,
    "keyboard_release_ms": 120,
    "hold_note_in_sector": false,
    "hold_zero_grace_ms": 120,
    "intensity_changes_enabled": true,
    "hold_sustain_floor": 0.12,
    "event_retrigger_debounce_ms": 20,
    "level_fade_ms": 30,
    "instrument": { "soundfont": "../../sounds/piano.sf2", "bank": 0, "preset": 0 }
  },
  "devices": {
    "1": {
      "event_source": "software",
      "note_map": [60, 62, 64, 67, 69, 72],
      "instrument": { "soundfont": "../../sounds/random.sf2", "bank": 0, "preset": 0 }
    },
    "2": {
      "event_source": "hardware",
      "note_map": [48, 50, 52, 55, 57, 60],
      "instrument": { "soundfont": "../../sounds/guitar.sf2", "bank": 0, "preset": 0 }
    }
  }
}
